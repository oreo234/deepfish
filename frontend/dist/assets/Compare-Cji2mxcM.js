import{_ as e,u as a,a as l,f as s,b as i,k as o,r as n,w as r,E as c,o as d,l as t,F as u,g as m,h as p,j as g}from"./index-rHRo5HIh.js";import{f as h}from"./index-proxR6sI.js";const f={class:"compare-container"},v={class:"upload-section"},y={key:0,class:"preview-area"},_=["src"],I={key:0,class:"comparison-section"},w={class:"model-cards"},F={class:"card-header"},C={class:"card-content"},b={class:"result-image-container"},R=["src"],U={class:"result-info"},k={class:"fish-class"},P={class:"value"},N={class:"confidence"},G={class:"inference-time"},B={class:"value"};const D=e({name:"ComparePage",components:{UploadFilled:a},data:()=>({imageUrl:"",imageFile:null,uploadedImageId:null,loading:!1,comparisonResults:null,models:[{id:"yolo_public_model",name:"YOLOv8",type:"目标检测",color:"#409EFF"},{id:"faster_rcnn_public_model",name:"Faster R-CNN",type:"目标检测",color:"#67C23A"},{id:"retinanet_public_model",name:"RetinaNet",type:"目标检测",color:"#E6A23C"},{id:"yolo_my_model",name:"YOLOv8-自建数据集",type:"目标检测",color:"#909399"}],classNameMap:{AngelFish:"神仙鱼 (Pterophyllum scalare)",BlueTang:"蓝吊 (Paracanthurus hepatus)",ButterflyFish:"蝶鱼 (Chaetodontidae)",ClownFish:"小丑鱼 (Amphiprioninae)",GoldFish:"金鱼 (Carassius auratus)",Gourami:"丝足鱼/吻鱼 (Osphronemidae)",MorishIdol:"莫里什神仙鱼 (Zanclidae)",PlatyFish:"月光鱼/剑尾鱼 (Xiphophorus maculatus)",RibbonedSweetlips:"丝鳢/花唇鱼 (Plectorhinchus polytaenia)",ThreeStripedDamselfish:"三带豆娘 (Dascyllus aruanus)",YellowCichlid:"黄慈鲷 (Labidochromis caeruleus)",YellowTang:"黄吊 (Zebrasoma flavescens)",ZebraFish:"斑马鱼 (Danio rerio)"}}),methods:{goBack(){this.$router.push("/")},handleFileChange(e){var a;if(!e)return;const l=(null==(a=e.raw)?void 0:a.type)||"";["image/jpeg","image/png","image/gif"].includes(l)?(this.imageFile=e.raw,this.imageUrl=URL.createObjectURL(e.raw),this.comparisonResults=null,h.uploadImage(e.raw).then(e=>{e&&e.id?(this.uploadedImageId=e.id,c.success(`图片上传成功，ID: ${e.id}`)):c.warning("上传成功，但未返回图片ID")}).catch(e=>{c.error("图片上传失败，请稍后重试")})):c.error("只能上传JPG、PNG或GIF格式的图片!")},async compareModels(){if(this.imageUrl){if(!this.uploadedImageId&&this.imageFile)try{const e=await h.uploadImage(this.imageFile);e&&e.id&&(this.uploadedImageId=e.id,c.success(`图片重新上传成功，ID: ${e.id}`))}catch(e){}if(this.uploadedImageId){this.loading=!0,this.comparisonResults={};try{const e=this.models.map(e=>e.id).map(async e=>{var a;const l=performance.now(),s=await h.predictById(this.uploadedImageId,e),i=(performance.now()-l)/1e3,o=(null==(a=null==s?void 0:s.detections)?void 0:a[0])||{},n=this.classNameMap[o.class_name]||o.class_name||"未知",r=Number(o.confidence||0);this.comparisonResults[e]={image_url:(null==s?void 0:s.result_image_id)?h.getImageUrl(s.result_image_id):this.imageUrl,class:n,confidence:r,inference_time:Number(i.toFixed(3))}});await Promise.allSettled(e)}catch(a){c.error("对比请求失败，请稍后重试")}finally{this.loading=!1}}else c.error("缺少图片ID，无法开始对比分析。请重新上传图片。")}else c.warning("请先上传图片")},getTagType:e=>["","success","warning"][e]||"",getConfidenceColor:e=>e>.8?"#67C23A":e>.5?"#E6A23C":"#F56C6C"}},[["render",function(e,a,c,h,D,T){const x=n("el-page-header"),A=n("upload-filled"),M=n("el-icon"),O=n("el-upload"),j=n("el-button"),L=n("el-tag"),E=n("el-progress"),Y=n("el-card"),S=n("el-col"),Z=n("el-row");return d(),l("div",f,[s(x,{onBack:T.goBack,title:"返回首页",content:"模型对比"},null,8,["onBack"]),i("div",v,[s(O,{class:"upload-box",drag:"",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":T.handleFileChange},{default:r(()=>[s(M,{class:"upload-icon"},{default:r(()=>[s(A)]),_:1}),a[0]||(a[0]=i("div",{class:"upload-text"},[i("span",null,"拖拽图片到此处或点击上传"),i("p",null,"支持 JPG、PNG、GIF 格式图片")],-1))]),_:1},8,["on-change"]),D.imageUrl?(d(),l("div",y,[i("img",{src:D.imageUrl,class:"preview-image"},null,8,_),s(j,{type:"primary",onClick:T.compareModels,loading:D.loading},{default:r(()=>[...a[1]||(a[1]=[t("开始对比分析",-1)])]),_:1},8,["onClick","loading"])])):o("",!0)]),D.comparisonResults?(d(),l("div",I,[a[5]||(a[5]=i("h2",null,"模型对比结果",-1)),i("div",w,[s(Z,{gutter:20},{default:r(()=>[(d(!0),l(u,null,m(D.models,(e,l)=>(d(),p(S,{span:8,key:l},{default:r(()=>[s(Y,{class:"model-card",shadow:"hover"},{header:r(()=>[i("div",F,[i("h3",null,g(e.name),1),s(L,{type:T.getTagType(l)},{default:r(()=>[t(g(e.type),1)]),_:2},1032,["type"])])]),default:r(()=>{var l,o,n,r,c;return[i("div",C,[i("div",b,[i("img",{src:(null==(l=D.comparisonResults[e.id])?void 0:l.image_url)||D.imageUrl,class:"result-image"},null,8,R)]),i("div",U,[i("div",k,[a[2]||(a[2]=i("span",{class:"label"},"识别结果:",-1)),i("span",P,g((null==(o=D.comparisonResults[e.id])?void 0:o.class)||"未知"),1)]),i("div",N,[a[3]||(a[3]=i("span",{class:"label"},"置信度:",-1)),s(E,{percentage:Math.round(100*((null==(n=D.comparisonResults[e.id])?void 0:n.confidence)||0)),color:T.getConfidenceColor((null==(r=D.comparisonResults[e.id])?void 0:r.confidence)||0)},null,8,["percentage","color"])]),i("div",G,[a[4]||(a[4]=i("span",{class:"label"},"推理时间:",-1)),i("span",B,g((null==(c=D.comparisonResults[e.id])?void 0:c.inference_time)||0)+" 秒",1)])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])])):o("",!0)])}],["__scopeId","data-v-eb6ef4d8"]]);export{D as default};
